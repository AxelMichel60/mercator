import{I as f,g as M,b as k,i as Z,c as tt,P as S,C as O,d as et,s as st,R as D,e as it,f as B,h as nt,E as H,j as w,k as rt,O as F,G as lt,a as ot,l as at,S as ht,m as dt,n as ct,V as _,o as G,p as N,q as ut,M as U}from"./ModelXmlSerializer-Bfl79C_f.js";class j{constructor(t){this.first=null,this.destroyed=!1,this.dragHandler=null,this.dropHandler=null,this.x=0,this.y=0,this.width=0,this.height=0,this.defaultOpacity=20,this.enabled=!0,this.div=null,this.sharedDiv=null,this.currentX=0,this.currentY=0,this.fadeOut=!1,this.graph=t,this.graph.addMouseListener(this),this.forceRubberbandHandler=(e,s)=>{const n=s.getProperty("eventName"),i=s.getProperty("event");if(n===f.MOUSE_DOWN&&this.isForceRubberbandEvent(i)){const l=M(this.graph.container),a=k(this.graph.container);a.x-=l.x,a.y-=l.y,this.start(i.getX()+a.x,i.getY()+a.y),i.consume(!1)}},this.graph.addListener(f.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=()=>{this.repaint()},this.graph.addListener(f.PAN,this.panHandler),this.gestureHandler=(e,s)=>{this.first&&this.reset()},this.graph.addListener(f.GESTURE,this.gestureHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isForceRubberbandEvent(t){return Z(t.getEvent())}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&!e.getState()&&!tt(e.getEvent())){const s=M(this.graph.container),n=k(this.graph.container);n.x-=s.x,n.y-=s.y,this.start(e.getX()+n.x,e.getY()+n.y),e.consume(!1)}}start(t,e){this.first=new S(t,e);const{container:s}=this.graph;function n(i){const l=new nt(i),a=B(s,l.getX(),l.getY());return l.graphX=a.x,l.graphY=a.y,l}this.dragHandler=i=>{this.mouseMove(this.graph,n(i))},this.dropHandler=i=>{this.mouseUp(this.graph,n(i))},O.IS_FF&&f.addGestureListeners(document,null,this.dragHandler,this.dropHandler)}mouseMove(t,e){if(!e.isConsumed()&&this.first){const s=k(this.graph.container),n=M(this.graph.container);s.x-=n.x,s.y-=n.y;const i=e.getX()+s.x,l=e.getY()+s.y,a=this.first.x-i,d=this.first.y-l,h=this.graph.getEventTolerance();(this.div||Math.abs(a)>h||Math.abs(d)>h)&&(this.div||(this.div=this.createShape()),et(),this.update(i,l),e.consume())}}createShape(){this.sharedDiv||(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",st(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv);const t=this.sharedDiv;return O.IS_SVG&&this.fadeOut&&(this.sharedDiv=null),t}isActive(t,e){return this.div&&this.div.style.display!=="none"}mouseUp(t,e){const s=this.isActive();this.reset(),s&&(this.execute(e.getEvent()),e.consume())}execute(t){const e=new D(this.x,this.y,this.width,this.height);this.graph.selectRegion(e,t)}reset(){if(this.div)if(O.IS_SVG&&this.fadeOut){const t=this.div;it(t.style,"transition","all 0.2s linear"),t.style.pointerEvents="none",t.style.opacity=String(0),window.setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},200)}else this.div.parentNode&&this.div.parentNode.removeChild(this.div);f.removeGestureListeners(document,null,this.dragHandler,this.dropHandler),this.dragHandler=null,this.dropHandler=null,this.currentX=0,this.currentY=0,this.first=null,this.div=null}update(t,e){this.currentX=t,this.currentY=e,this.repaint()}repaint(){if(this.div&&this.first){const t=this.currentX-this.graph.getPanDx(),e=this.currentY-this.graph.getPanDy();this.x=Math.min(this.first.x,t),this.y=Math.min(this.first.y,e),this.width=Math.max(this.first.x,t)-this.x,this.height=Math.max(this.first.y,e)-this.y;const s=0,n=0;this.div.style.left=`${this.x+s}px`,this.div.style.top=`${this.y+n}px`,this.div.style.width=`${Math.max(1,this.width)}px`,this.div.style.height=`${Math.max(1,this.height)}px`}}onDestroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),this.sharedDiv&&(this.sharedDiv=null))}}j.pluginId="RubberBandHandler";class gt extends H{constructor(t=100){super(),this.size=100,this.history=[],this.indexOfNextAdd=0,this.size=t,this.clear()}isEmpty(){return this.history.length==0}clear(){this.history=[],this.indexOfNextAdd=0,this.fireEvent(new w(f.CLEAR))}canUndo(){return this.indexOfNextAdd>0}undo(){for(;this.indexOfNextAdd>0;){const t=this.history[--this.indexOfNextAdd];if(t.undo(),t.isSignificant()){this.fireEvent(new w(f.UNDO,{edit:t}));break}}}canRedo(){return this.indexOfNextAdd<this.history.length}redo(){const t=this.history.length;for(;this.indexOfNextAdd<t;){const e=this.history[this.indexOfNextAdd++];if(e.redo(),e.isSignificant()){this.fireEvent(new w(f.REDO,{edit:e}));break}}}undoableEditHappened(t){this.trim(),this.size>0&&this.size==this.history.length&&this.history.shift(),this.history.push(t),this.indexOfNextAdd=this.history.length,this.fireEvent(new w(f.ADD,{edit:t}))}trim(){if(this.history.length>this.indexOfNextAdd){const t=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd);for(let e=0;e<t.length;e+=1)t[e].die()}}}class ft{constructor(t){this.useBoundingBox=!0,this.parent=null,this.graph=t}moveCell(t,e,s){}resizeCell(t,e,s){}execute(t){}getGraph(){return this.graph}getConstraint(t,e,s,n){return this.graph.getCurrentCellStyle(e)[t]}traverse({vertex:t,directed:e,func:s,edge:n,visited:i}){if(s!=null&&t!=null&&(e=e??!0,i=i||new Map,!i.get(t))){i.set(t,!0);const l=s(t,n);if(l==null||l){const a=t.getEdgeCount();if(a>0)for(let d=0;d<a;d+=1){const h=t.getEdgeAt(d),c=h.getTerminal(!0)===t;if(!e||c){const u=this.graph.view.getVisibleTerminal(h,!c);this.traverse({vertex:u,directed:e,func:s,edge:h,visited:i})}}}}}isAncestor(t,e,s){if(!s)return e.getParent()===t;if(e===t)return!1;for(;e!=null&&e!==t;)e=e.getParent();return e===t}isVertexMovable(t){return this.graph.isCellMovable(t)}isVertexIgnored(t){return!t.isVertex()||!t.isVisible()}isEdgeIgnored(t){return!t.isEdge()||!t.isVisible()||t.getTerminal(!0)==null||t.getTerminal(!1)==null}setEdgeStyleEnabled(t,e){this.graph.setCellStyles("noEdgeStyle",e?"0":"1",[t])}setOrthogonalEdge(t,e){this.graph.setCellStyles("orthogonal",e?"1":"0",[t])}getParentOffset(t){const e=new S;if(t!=null&&t!==this.parent&&(this.graph.getDataModel(),this.parent&&this.parent.isAncestor(t))){let s=t.getGeometry();for(;t!==this.parent;)e.x+=s.x,e.y+=s.y,t=t.getParent(),s=t.getGeometry()}return e}setEdgePoints(t,e){if(t!=null){const{model:s}=this.graph;let n=t.getGeometry();if(n==null?(n=new rt,n.setRelative(!0)):n=n.clone(),this.parent!=null&&e!=null){const i=t.getParent(),l=this.getParentOffset(i);for(let a=0;a<e.length;a+=1)e[a].x=e[a].x-l.x,e[a].y=e[a].y-l.y}n.points=e,s.setGeometry(t,n)}}setVertexLocation(t,e,s){const n=this.graph.getDataModel();let i=t.getGeometry(),l=null;if(i!=null){if(l=new D(e,s,i.width,i.height),this.useBoundingBox){const a=this.graph.getView().getState(t);if(a!=null&&a.text!=null&&a.text.boundingBox!=null){const{scale:d}=this.graph.getView(),h=a.text.boundingBox;a.text.boundingBox.x<a.x&&(e+=(a.x-h.x)/d,l.width=h.width),a.text.boundingBox.y<a.y&&(s+=(a.y-h.y)/d,l.height=h.height)}}if(this.parent!=null){const a=t.getParent();if(a!=null&&a!==this.parent){const d=this.getParentOffset(a);e-=d.x,s-=d.y}}(i.x!==e||i.y!==s)&&(i=i.clone(),i.x=e,i.y=s,n.setGeometry(t,i))}return l}getVertexBounds(t){let e=t.getGeometry();if(this.useBoundingBox){const s=this.graph.getView().getState(t);if(s!=null&&s.text!=null&&s.text.boundingBox!=null){const{scale:n}=this.graph.getView(),i=s.text.boundingBox,l=Math.max(s.x-i.x,0)/n,a=Math.max(s.y-i.y,0)/n,d=Math.max(i.x+i.width-(s.x+s.width),0)/n,h=Math.max(i.y+i.height-(s.y+s.height),0)/n;e=new D(e.x-l,e.y-a,e.width+l+d,e.height+a+h)}}if(this.parent!=null){const s=t.getParent();if(e=e.clone(),s!=null&&s!==this.parent){const n=this.getParentOffset(s);e.x+=n.x,e.y+=n.y}}return new D(e.x,e.y,e.width,e.height)}arrangeGroups(t,e,s,n,i,l){return this.graph.updateGroupBounds(t,e,!0,s,n,i,l)}}class pt extends ft{constructor(t){super(t),this.useInputOrigin=!0,this.resetEdges=!0,this.disableEdgeStyle=!0,this.forceConstant=50,this.forceConstantSquared=0,this.minDistanceLimit=2,this.maxDistanceLimit=500,this.minDistanceLimitSquared=4,this.initialTemp=200,this.temperature=0,this.maxIterations=0,this.iteration=0,this.vertexArray=[],this.dispX=[],this.dispY=[],this.cellLocation=[],this.radius=[],this.radiusSquared=[],this.isMoveable=[],this.neighbours={},this.indices={},this.allowedToRun=!0}isVertexIgnored(t){return super.isVertexIgnored(t)||this.graph.getConnections(t).length===0}execute(t){this.vertexArray=[];let e=this.graph.getChildVertices(t);for(let i=0;i<e.length;i+=1)this.isVertexIgnored(e[i])||this.vertexArray.push(e[i]);const s=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,n=this.vertexArray.length;this.indices={},this.dispX=[],this.dispY=[],this.cellLocation=[],this.isMoveable=[],this.neighbours={},this.radius=[],this.radiusSquared=[],this.forceConstant<.001&&(this.forceConstant=.001),this.forceConstantSquared=this.forceConstant*this.forceConstant;for(let i=0;i<this.vertexArray.length;i+=1){const l=this.vertexArray[i];this.cellLocation[i]=[];const a=F.get(l);this.indices[a]=i;const d=this.getVertexBounds(l),{width:h}=d,{height:c}=d,{x:u}=d,{y:x}=d;this.cellLocation[i][0]=u+h/2,this.cellLocation[i][1]=x+c/2,this.radius[i]=Math.min(h,c),this.radiusSquared[i]=this.radius[i]*this.radius[i]}this.graph.batchUpdate(()=>{for(let h=0;h<n;h+=1){this.dispX[h]=0,this.dispY[h]=0,this.isMoveable[h]=this.isVertexMovable(this.vertexArray[h]);const c=this.graph.getConnections(this.vertexArray[h],t);e=this.graph.getOpposites(c,this.vertexArray[h]),this.neighbours[h]=[];for(let u=0;u<e.length;u+=1){this.resetEdges&&this.graph.resetEdge(c[u]),this.disableEdgeStyle&&this.setEdgeStyleEnabled(c[u],!1);const x=F.get(e[u]),b=this.indices[x];b!=null?this.neighbours[h][u]=b:this.neighbours[h][u]=h}}for(this.temperature=this.initialTemp,this.maxIterations===0&&(this.maxIterations=20*Math.sqrt(n)),this.iteration=0;this.iteration<this.maxIterations;this.iteration+=1){if(!this.allowedToRun)return;this.calcRepulsion(),this.calcAttraction(),this.calcPositions(),this.reduceTemperature()}let i=null,l=null;for(let h=0;h<this.vertexArray.length;h+=1){const c=this.vertexArray[h];if(this.isVertexMovable(c)){const u=this.getVertexBounds(c);if(u!=null){this.cellLocation[h][0]-=u.width/2,this.cellLocation[h][1]-=u.height/2;const x=this.graph.snap(Math.round(this.cellLocation[h][0])),b=this.graph.snap(Math.round(this.cellLocation[h][1]));this.setVertexLocation(c,x,b),i==null?i=x:i=Math.min(i,x),l==null?l=b:l=Math.min(l,b)}}}let a=-(i||0)+1,d=-(l||0)+1;s!=null&&(a+=s.x,d+=s.y),this.graph.moveCells(this.vertexArray,a,d)})}calcPositions(){for(let t=0;t<this.vertexArray.length;t+=1)if(this.isMoveable[t]){let e=Math.sqrt(this.dispX[t]*this.dispX[t]+this.dispY[t]*this.dispY[t]);e<.001&&(e=.001);const s=this.dispX[t]/e*Math.min(e,this.temperature),n=this.dispY[t]/e*Math.min(e,this.temperature);this.dispX[t]=0,this.dispY[t]=0,this.cellLocation[t][0]+=s,this.cellLocation[t][1]+=n}}calcAttraction(){for(let t=0;t<this.vertexArray.length;t+=1)for(let e=0;e<this.neighbours[t].length;e+=1){const s=this.neighbours[t][e];if(t!==s&&this.isMoveable[t]&&this.isMoveable[s]){const n=this.cellLocation[t][0]-this.cellLocation[s][0],i=this.cellLocation[t][1]-this.cellLocation[s][1];let l=n*n+i*i-this.radiusSquared[t]-this.radiusSquared[s];l<this.minDistanceLimitSquared&&(l=this.minDistanceLimitSquared);const a=Math.sqrt(l),d=l/this.forceConstant,h=n/a*d,c=i/a*d;this.dispX[t]-=h,this.dispY[t]-=c,this.dispX[s]+=h,this.dispY[s]+=c}}}calcRepulsion(){const t=this.vertexArray.length;for(let e=0;e<t;e+=1)for(let s=e;s<t;s+=1){if(!this.allowedToRun)return;if(s!==e&&this.isMoveable[e]&&this.isMoveable[s]){let n=this.cellLocation[e][0]-this.cellLocation[s][0],i=this.cellLocation[e][1]-this.cellLocation[s][1];n===0&&(n=.01+Math.random()),i===0&&(i=.01+Math.random());const l=Math.sqrt(n*n+i*i);let a=l-this.radius[e]-this.radius[s];if(a>this.maxDistanceLimit)continue;a<this.minDistanceLimit&&(a=this.minDistanceLimit);const d=this.forceConstantSquared/a,h=n/l*d,c=i/l*d;this.dispX[e]+=h,this.dispY[e]+=c,this.dispX[s]-=h,this.dispY[s]-=c}}}reduceTemperature(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)}}class yt extends H{constructor(t=20){super(),this.thread=null,this.delay=t}isRunning(){return this.thread!=null}startAnimation(){this.thread==null&&(this.thread=window.setInterval(this.updateAnimation.bind(this),this.delay))}updateAnimation(){this.fireEvent(new w(f.EXECUTE))}stopAnimation(){this.thread!=null&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new w(f.DONE)))}}class mt{constructor(t){this.count=0,this.deltas=new Map,this.graph=t}isEmpty(){return this.count===0}moveState(t,e,s,n=!0,i=!0){let l=this.deltas.get(t.cell);return l==null?(l={point:new S(e,s),state:t},this.deltas.set(t.cell,l),this.count++):n?(l.point.x+=e,l.point.y+=s):(l.point.x=e,l.point.y=s),i&&this.addEdges(t),l.point}show(t=null){this.deltas.forEach(e=>{this.translateState(e.state,e.point.x,e.point.y)}),this.deltas.forEach(e=>{this.revalidateState(e.state,e.point.x,e.point.y,t)})}translateState(t,e,s){if(t!=null){if(t.cell.isVertex()){t.view.updateCellState(t);const n=t.cell.getGeometry();(e!==0||s!==0)&&n!=null&&(!n.relative||this.deltas.get(t.cell)!=null)&&(t.x+=e,t.y+=s)}for(const n of t.cell.getChildren())this.translateState(t.view.getState(n),e,s)}}revalidateState(t,e,s,n=null){t.cell.isEdge()&&t.view.updateCellState(t);const i=t.cell.getGeometry(),l=t.view.getState(t.cell.getParent());(e!==0||s!==0)&&i!=null&&i.relative&&t.cell.isVertex()&&(l==null||l.cell.isVertex()||this.deltas.get(t.cell)!=null)&&(t.x+=e,t.y+=s),this.graph.cellRenderer.redraw(t),n!=null&&n(t);for(const a of t.cell.getChildren())this.revalidateState(this.graph.view.getState(a),e,s,n)}addEdges(t){const e=t.cell.getEdgeCount();for(let s=0;s<e;s+=1){const n=t.view.getState(t.cell.getEdgeAt(s));n!=null&&this.moveState(n,0,0)}}}class xt extends yt{constructor(t,e=6,s=1.5,n){super(n),this.step=0,this.cells=null,this.graph=t,this.steps=e,this.ease=s}updateAnimation(){super.updateAnimation();const t=new mt(this.graph);if(this.cells!=null)for(const e of this.cells)this.animateCell(e,t,!1);else this.animateCell(this.graph.getDataModel().getRoot(),t,!0);this.show(t),(t.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()}show(t){t.show()}animateCell(t,e,s=!1){const n=this.graph.getView().getState(t);let i=null;if(n!=null&&(i=this.getDelta(n),t.isVertex()&&(i.x!=0||i.y!=0))){const l=this.graph.view.getTranslate(),a=this.graph.view.getScale();i.x+=l.x*a,i.y+=l.y*a,e.moveState(n,-i.x/this.ease,-i.y/this.ease)}if(s&&!this.stopRecursion(n,i)){const l=t.getChildCount();for(let a=0;a<l;a+=1)this.animateCell(t.getChildAt(a),e,s)}}stopRecursion(t=null,e=null){return e!=null&&(e.x!=0||e.y!=0)}getDelta(t){const e=this.getOriginForCell(t.cell),s=this.graph.getView().getTranslate(),n=this.graph.getView().getScale(),i=t.x/n-s.x,l=t.y/n-s.y;return new S((e.x-i)*n,(e.y-l)*n)}getOriginForCell(t=null){let e=null;if(t!=null){const s=t.getParent(),n=t.getGeometry();if(e=this.getOriginForCell(s),n!=null&&s!=null)if(n.relative){const i=s.getGeometry();i!=null&&(e.x+=n.x*i.width,e.y+=n.y*i.height)}else e.x+=n.x,e.y+=n.y}if(e==null){const s=this.graph.view.getTranslate();e=new S(-s.x,-s.y)}return e}}const vt=[at,ht,dt,ct,j],p=document.getElementById("graph-container");document.createElement("div");const o=new lt(p,new ot,vt),E=o.getDataModel();var C=o.getStylesheet().getDefaultEdgeStyle();C.labelBackgroundColor="#FFFFFF";C.strokeWidth=2;C.rounded=!0;C.entryPerimeter=!1;C.edgeStyle="manhattanEdgeStyle";o.getFoldingImage=()=>null;_.selectionColor="#00a8ff";_.selectionStrokeWidth=2;const m=new gt,W=(r,t)=>{m.undoableEditHappened(t.getProperty("edit"))};E.addListener(f.UNDO,W);o.getView().addListener(f.UNDO,W);const Et=document.getElementById("undoButton"),bt=document.getElementById("redoButton");Et.addEventListener("click",()=>{m.canUndo()&&m.undo()});bt.addEventListener("click",()=>{m.canRedo()&&m.redo()});document.addEventListener("keydown",r=>{r.ctrlKey&&r.key==="z"?(r.preventDefault(),m.canUndo()&&m.undo()):r.ctrlKey&&r.key==="y"&&(r.preventDefault(),m.canRedo()&&m.redo())});const y=document.getElementById("edge-context-menu"),A=document.getElementById("edge-color-select"),I=document.getElementById("edge-thickness-select"),v=document.getElementById("text-context-menu"),K=document.getElementById("text-font-select"),J=document.getElementById("text-color-select"),Q=document.getElementById("text-size-select"),R=document.getElementById("text-bold-select"),T=document.getElementById("text-italic-select"),P=document.getElementById("text-underline-select");let g=null;o.container.addEventListener("contextmenu",r=>{r.preventDefault();const t=o.getCellAt(r.offsetX,r.offsetY);if(t!=null)if(t.isEdge()){g=t;const e=p.getBoundingClientRect(),s=r.clientX-e.left,n=r.clientY-e.top;y.style.display="block",y.style.left=`${s+75}px`,y.style.top=`${n+100}px`;const i=o.getCellStyle(t);A.value=i.strokeColor||"#000000",I.value=i.strokeWidth||"1"}else if(t.isVertex()){if(t.value!=null&&t.value!=""){g=t;const e=p.getBoundingClientRect(),s=r.clientX-e.left,n=r.clientY-e.top;v.style.display="block",v.style.left=`${s+75}px`,v.style.top=`${n+100}px`;const i=o.getCellStyle(t);J.value=i.fontColor||"#000000",K.value=i.fontFamily||"Arial",Q.value=i.fontSize||"12",g.style.fontStyle&1?R.classList.add("selected"):R.classList.remove("selected"),g.style.fontStyle&2?T.classList.add("selected"):T.classList.remove("selected"),g.style.fontStyle&4?P.classList.add("selected"):P.classList.remove("selected")}else if(t.style.image==null&&t.children.length==0){g=t;const e=p.getBoundingClientRect(),s=r.clientX-e.left,n=r.clientY-e.top;y.style.display="block",y.style.left=`${s+75}px`,y.style.top=`${n+100}px`;const i=o.getCellStyle(t);A.value=i.strokeColor||"#000000",I.value=i.strokeWidth||"1"}}else v.style.display="none",y.style.display="none"});const wt=document.getElementById("apply-edge-style");wt.addEventListener("click",r=>{r.preventDefault(),g&&o.batchUpdate(()=>{o.getCellStyle(g),g.isEdge()?(g.style.strokeColor=A.value,g.style.strokeWidth=parseInt(I.value,10)):(g.style.fillColor=A.value,g.style.strokeWidth=parseInt(I.value,10)),o.refresh(g)}),y.style.display="none"});const St=document.getElementById("apply-text-style");St.addEventListener("click",r=>{r.preventDefault(),g&&o.batchUpdate(()=>{g.style.fontFamily=K.value,g.style.fontColor=J.value,g.style.fontSize=parseInt(Q.value,10);var t=0;t=t|(R.classList.contains("selected")?1:0),t=t|(T.classList.contains("selected")?2:0),t=t|(P.classList.contains("selected")?4:0),g.style.fontStyle=t,o.refresh(g)}),v.style.display="none"});const Ct=document.querySelectorAll(".button");Ct.forEach(r=>{r.addEventListener("click",()=>{Lt(r)})});function Lt(r){r.classList.toggle("selected")}document.addEventListener("click",r=>{v.contains(r.target)||(v.style.display="none"),y.contains(r.target)||(y.style.display="none")});o.setGridEnabled(!0);o.setGridSize(10);p.style.backgroundImage=`
  linear-gradient(to right, #e0e0e0 1px, transparent 1px),
  linear-gradient(to bottom, #e0e0e0 1px, transparent 1px)
`;p.style.backgroundSize="10px 10px";o.setPanning(!0);o.allowAutoPanning=!0;o.useScrollbarsForPanning=!0;function Dt(r){new U(E).import(r)}window.loadGraph=Dt;async function At(r,t,e,s){try{const n=await fetch("/admin/graph/save",{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({id:r,name:t,type:e,content:s})});if(n.status!=200){const i=await n.json();throw new Error(i.message||"Erreur lors de la sauvegarde du graphe.")}}catch(n){console.error("Erreur lors de la sauvegarde :",n),alert("Erreur lors de la sauvegarde du graphe.")}}function It(){return new U(E).export()}window.getXMLGraph=It;function Bt(){const r=new U(E).export();At(document.querySelector("#id").value,document.querySelector("#name").value,document.querySelector("#type").value,r)}const Mt=document.getElementById("saveButton");Mt.addEventListener("click",Bt);const kt=document.getElementById("font-btn");kt.addEventListener("dragstart",r=>{r.dataTransfer.setData("node-type","text-node")});p.addEventListener("dragover",r=>{r.preventDefault()});p.addEventListener("drop",r=>{if(r.preventDefault(),r.dataTransfer.getData("node-type")=="text-node"){const t=B(o.container,N(r),G(r)),e=o.view.translate,{scale:s}=o.view,n=t.x/s-e.x,i=t.y/s-e.y;o.batchUpdate(()=>{const l=o.getDefaultParent();o.insertVertex({parent:l,value:"Text",position:[n,i],size:[150,30],style:{fillColor:"none",strokeColor:"none",fontColor:"#000000",fontSize:14,align:"left",verticalAlign:"middle"}}).setAttribute("editable","true")})}});const Ot=document.getElementById("square-btn");Ot.addEventListener("dragstart",r=>{r.dataTransfer.setData("node-type","square-node")});p.addEventListener("dragover",r=>{r.preventDefault()});p.addEventListener("drop",r=>{if(r.preventDefault(),r.dataTransfer.getData("node-type")=="square-node"){const t=B(o.container,N(r),G(r)),e=o.view.translate,{scale:s}=o.view,n=t.x/s-e.x,i=t.y/s-e.y;o.batchUpdate(()=>{const l=o.getDefaultParent(),a=o.insertVertex({parent:l,value:"",position:[n,i],size:[150,120],style:{fillColor:"#fffacd",strokeColor:"#000000",strokeWidth:1,rounded:2}});o.orderCells(!0,[a])})}});const X=document.getElementById("nodeImage"),V=document.getElementById("node");X.addEventListener("dragstart",r=>{r.dataTransfer.setData("node-type","icon-node")});p.addEventListener("dragover",r=>{r.preventDefault()});p.addEventListener("drop",r=>{if(r.preventDefault(),r.dataTransfer.getData("node-type")=="icon-node"&&X.src!=""){const t=B(o.container,N(r),G(r)),e=o.view.translate,{scale:s}=o.view,n=t.x/s-e.x,i=t.y/s-e.y;o.batchUpdate(()=>{const l=o.getDefaultParent(),a=E.getCell(V.value);if(a!=null)o.setSelectionCells(a);else{const d=_nodes.get(V.value),h=o.insertVertex({parent:l,id:V.value,value:d.label,position:[n-16,i-16],size:[32,32],style:{shape:"image",image:X.src,editable:!1,resizable:!0,verticalLabelPosition:"bottom",spacingTop:-15}});d.edges.forEach(function(c){const u=E.getCell(c.attachedNodeId);u!=null&&o.insertEdge({parent:l,value:"",source:h,target:u,style:{editable:!1,strokeColor:"#ff0000",strokeWidth:1,startArrow:"none",endArrow:"none"}})})}})}});const Vt=document.getElementById("zoom-in-btn"),Rt=document.getElementById("zoom-out-btn");Vt.addEventListener("click",()=>{o.zoomIn()});Rt.addEventListener("click",()=>{o.zoomOut()});document.addEventListener("keydown",r=>{if(r.key==="Delete"||r.key==="Backspace"){const t=o.getSelectionCells();t.length>0&&o.removeCells(t)}});$("body").keydown(function(r){r.ctrlKey&&r.keyCode==65&&(r.preventDefault(),r.stopPropagation(),o.selectAll())});o.setConnectable(!1);o.isCellDisconnectable=function(){return!1};const Tt=document.getElementById("group-btn"),Pt=document.getElementById("ungroup-btn");Tt.addEventListener("click",()=>{const r=o.getSelectionCells();if(r.length>1){const t=o.getDefaultParent(),e=o.insertVertex({parent:t,style:{fillColor:"none",strokeColor:"none"}});o.addCell(e),o.groupCells(e,5,r)}});Pt.addEventListener("click",()=>{const r=o.getSelectionCells();r.length==1&&(o.ungroupCells(r),o.setSelectionCells(r))});function L(r,t,e){const s=r.getSelectionCell();s&&s.isVertex()&&r.batchUpdate(()=>{const n=s.getGeometry();n&&(n.translate(t,e),r.refresh())})}document.addEventListener("keydown",r=>{switch(r.key){case"ArrowUp":L(o,0,-1);break;case"ArrowDown":L(o,0,1);break;case"ArrowLeft":L(o,-1,0);break;case"ArrowRight":L(o,1,0);break}});function Xt(r,t,e){const s=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const l=i*n,a=r.x+t*Math.cos(l),d=r.y+t*Math.sin(l);s.push({x:a,y:d})}return s}function Gt(){let r=[];for(let t of document.getElementById("filters").options)t.selected&&r.push(t.value);return r}function Nt(r,t,e){if(r==null||t==null)return!1;let s=!1;return o.getEdges(r).forEach(i=>{if(i.target==t&&(e==null||i.value==e)){s=!0;return}}),s||o.getEdges(t).forEach(l=>{if(l.target==r&&(e==null||l.value==e)){s=!0;return}}),s}o.addListener(f.DOUBLE_CLICK,(r,t)=>{const e=t.getProperty("cell");if(e&&e.isVertex()&&e.style.shape=="image"){const s=_nodes.get(e.id);if(s==null)return;o.batchUpdate(()=>{let n=[];const i=o.getDefaultParent(),l=Gt();s.edges.forEach(function(d){let h=_nodes.get(d.attachedNodeId);if(h!=null){const c=E.getCell(d.attachedNodeId);c==null&&!n.some(u=>u.attachedNodeId==d.attachedNodeId)?(l.length==0||l.includes(h.vue)||l.includes("8")&&d.edgeType==="CABLE"||l.includes("9")&&d.edgeType==="FLUX")&&n.push(d):Nt(e,c,d.name)||o.insertEdge({parent:i,value:d.name,source:e,target:c,style:{editable:!1,stroke:"#FF",strokeWidth:1,startArrow:d.edgeType=="FLUX"&&(d.bidirectional||d.edgeDirection=="FROM")?"classic":"none",endArrow:d.edgeType=="FLUX"&&(d.bidirectional||d.edgeDirection=="TO")?"classic":"none"}})}}),p.getBoundingClientRect();const a=Xt({x:e.getGeometry().x,y:e.getGeometry().y},80,n.length);for(let d=0;d<a.length;d++){const h=n[d],c=_nodes.get(h.attachedNodeId),u=o.insertVertex({parent:i,id:c.id,value:c.label,position:[a[d].x,a[d].y],size:[32,32],style:{shape:"image",image:c.image,editable:!1,resizable:!0,verticalLabelPosition:"bottom",spacingTop:-15}});o.insertEdge({parent:i,value:n[d].name,source:e,target:u,style:{editable:!1,stroke:"#FF",strokeWidth:1,startArrow:h.edgeType=="FLUX"&&(h.bidirectional||h.edgeDirection=="FROM")?"classic":"none",endArrow:h.edgeType=="FLUX"&&(h.bidirectional||h.edgeDirection=="TO")?"classic":"none"}})}})}});const Ut=document.getElementById("update-btn");Ut.addEventListener("click",()=>{o.batchUpdate(()=>{o.getChildCells().forEach(t=>{if(!t.isEdge()){if(t.style.image!=null){const e=_nodes.get(t.id);e==null?o.removeCells([t],!0):(t.value=e.label,ut(o.getDataModel(),[t],{image:e.image}))}}}),o.refresh()})});const z=o.container.querySelector("svg");function Ft(r){r.querySelectorAll("image").forEach(e=>{const s=e.getAttribute("xlink:href");fetch(s).then(n=>n.blob()).then(n=>{const i=new FileReader;i.onloadend=()=>{e.setAttribute("xlink:href",i.result)},i.readAsDataURL(n)})})}function zt(){Ft(z),setTimeout(()=>{const t=new XMLSerializer().serializeToString(z),e=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download="graph_with_images.svg",n.click(),URL.revokeObjectURL(s)},1e3)}var Y;(Y=document.getElementById("download-btn"))==null||Y.addEventListener("click",zt);function Yt(){const r=o.getDefaultParent(),t=o.getChildVertices(r);if(!t||t.length===0)return;const e=new pt(o);e.forceConstant=60,e.disableEdgeStyle=!1,o.getDataModel().beginUpdate();try{e.execute(r,t)}finally{const s=new xt(o);s.addListener(f.DONE,()=>o.getDataModel().endUpdate()),s.startAnimation()}}var q;(q=document.getElementById("layout-btn"))==null||q.addEventListener("click",Yt);
